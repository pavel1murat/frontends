<!DOCTYPE html>
<html class="mcss" lang="en">
  <head>
    <meta charset="UTF-8">
    <title>Mu2e Main Page MV</title>
    <link rel="stylesheet" href="midas.css">
    <script src="controls.js"></script>
    <script src="midas.js"></script>
    <script src="mhttpd.js"></script>
    <script src="filesrw.js"></script>

    <script src="mu2edaq.js"></script>
    
    <script>
    
    function createSubsystemRows() {
      const subsystems = [
        { name: "Tracker"    , path: "/Mu2e/ActiveRunConfiguration/Tracker"    , link: "tracker_status.html" },
        { name: "Calorimeter", path: "/Mu2e/ActiveRunConfiguration/Calorimeter", link: "calorimeter_status.html" },
        { name: "CRV"        , path: "/Mu2e/ActiveRunConfiguration/CRV"        , link: "crv_status.html" },
        { name: "EXM"        , path: "/Mu2e/ActiveRunConfiguration/EXM"        , link: "exm_status.html" },
        { name: "STM"        , path: "/Mu2e/ActiveRunConfiguration/STM"        , link: "stm_status.html" },
        { name: "DAQ"        , path: "/Mu2e/ActiveRunConfiguration/DAQ"        , link: "daq_status.html" }
      ];
      
      const table = document.querySelector(".mtable tbody");
      
      subsystems.forEach((subsystem) => {
        const row = document.createElement("tr");
        
        // Subsystem Name
        let cell = document.createElement("td");
        cell.innerHTML = `<b>${subsystem.name}</b>`;
        row.appendChild(cell);
        
        // Enabled Cell
        cell = document.createElement('td');
        let div = document.createElement('div');
        div.className = 'modbvalue status-cell';
        div.dataset.odbPath = subsystem.path+'/Enabled';
        div.onchange = function(event) { set_colors(subsystem.path,cell); } ;
        // div.addEventListener('change',(e) => { set_colors(subsystem.path,statusCell); });

        cell.appendChild(div);
        row.appendChild(cell);

        // Status Cell
        cell = document.createElement('td');
        div = document.createElement('div');
        div.className = 'modbvalue status-cell';
        div.dataset.odbPath = subsystem.path+'/Status';
        div.onchange = function(event) { set_colors(subsystem.path,cell); } ;
        // div.addEventListener('change',(e) => { set_colors(subsystem.path,statusCell); });

        cell.appendChild(div);
        row.appendChild(cell);
        
        // Description Cell
        const descriptionCell = document.createElement('td');
        descriptionCell.innerHTML = `<a href="${subsystem.link}">${subsystem.name} Status</a>`;
        
        // Initial load
        set_colors(subsystem.path,descriptionCell);
        
        // Poll for updates
        setInterval(() => {set_colors(subsystem.path,descriptionCell);},2000);
        
        row.appendChild(descriptionCell);
        
        table.appendChild(row);
      });
    }
    
    document.addEventListener("DOMContentLoaded", createSubsystemRows);
    </script>

   <style>
      #mmain .mtable td {
         padding: 8px;
         text-align: center;
      }
      .status-cell {
         display: inline-block;
         width: 100px;
         height: 30px;
         text-align: center;
         line-height: 30px;
         border-radius: 5px;
      }
   </style>
</head>

<body class="mcss" onload="mhttpd_init('Custom Page Example');">

<!-- Header and side navigation filled by mhttpd_init -->
<div id="mheader"></div>
<div id="msidenav"></div>

<div id="mmain">
   <table class="mtable">
      <thead>
         <tr>
            <th colspan="4" class="mtableheader">Mu2e Main Page MV</th>
         </tr>
         <tr>
           <th style="padding:20px;">Subsystem</th>
           <th style="width: 250px;">Enabled  </th>
           <th style="width: 250px;">Status   </th>
           <th>Description</th>
         </tr>
      </thead>
      <tbody>
      </tbody>
   </table>
</div>

</body>
</html>

<!--
    emacs
    Local Variables:
    mode: web
    End:
  -->
