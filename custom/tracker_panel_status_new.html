<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <link   rel="stylesheet" href="midas.css">
    <link id="favicon" rel="shortcut icon" type="image/png" href="favicon.png" />
    <script src="controls.js"></script>
    <script src="midas.js"></script>
    <script src="mhttpd.js"></script>
    <script src="filesrw.js"></script>
    <script src="odbbrowser.js"></script>
  
    <link   rel="stylesheet" href="mu2edaq.css">
    <script src="mu2edaq.js"></script>
    <script src="trk_commands.js"></script>
    
    <title>StationPage</title>
    
    <script>
//-----------------------------------------------------------------------------
// main function: createTable
//-----------------------------------------------------------------------------
      function createTable() {
        const urlParams  = new URLSearchParams(window.location.search);
        g_hostname = urlParams.get('hostname') || 'none';  // 
        g_station  = urlParams.get("station" ) || "0";     // defined in trk_commands.js
        g_plane    = urlParams.get("plane"   ) || "0";
        g_panel    = urlParams.get("panel"   ) || "0";
        
        const g_plane1     = 2*g_station;
        const g_plane2     = 2*g_station+1;
        
        let title        = document.getElementById('table-title');
        title.innerHTML  = ''; //&nbsp;&nbsp;&nbsp;'+g_hostname+' DTC status page';
//-----------------------------------------------------------------------------
//  create DTC commands table
//-----------------------------------------------------------------------------
        const station_com_table     = document.getElementById('station_commands');

        station_com_table.innerHTML = `
        <thead>
          <tr>
            <td> <div class="mtableheader">station ${g_station}/plane ${g_plane}/panel ${g_panel} Controls  </div></td>
            <td>
              <div class="tab">
                <button class="tablinks" id="dtc0" onclick="choose_dtc_id(event,'dtc0')">plane:${g_plane1}</button>
                <button class="tablinks" id="dtc1" onclick="choose_dtc_id(event,'dtc1')">plane:${g_plane2}</button>
              </div>
            </td>
            <td colspan=3>
              <div class="tab">
                <button class="roctabs" id='roc0' onclick="choose_roc_id(event,'roc0')">ROC0</button>
                <button class="roctabs" id='roc1' onclick="choose_roc_id(event,'roc1')">ROC1</button>
                <button class="roctabs" id='roc2' onclick="choose_roc_id(event,'roc2')">ROC2</button>
                <button class="roctabs" id='roc3' onclick="choose_roc_id(event,'roc3')">ROC3</button>
                <button class="roctabs" id='roc4' onclick="choose_roc_id(event,'roc4')">ROC4</button>
                <button class="roctabs" id='roc5' onclick="choose_roc_id(event,'roc5')">ROC5</button>
                <button class="roctabs" id='roc6' onclick="choose_roc_id(event,'roc6')">ALL </button>
              </div>
            </td>
          </tr>
        </thead>
        <tbody>                                                                        
          <tr>
            <td colspan=2>
              <input type=button value='load parameters'  onClick='trk_station_load_parameters(g_station)'>
              <div class="dropup">
                <input type=button class="dropbtn" value='init readout'>
                <div class="dropup-content">
                  <div onClick='dtc_load_parameters_init_readout()'> Load Parameters </div>
                  <div onClick='trk_command_set_odb("trk_init_readout")'   > Run             </div>
                </div>
              </div>
              <input type=button value='print status' onClick='trk_command_set_odb("trk_station_print_status")'>
              <input type=button value='clear output' onClick='trk_clear_window("output_window")'>
            </td>
          </tr>
        </tbody>
         `;
        
        const com_tbody = station_com_table.querySelector("tbody");
//-----------------------------------------------------------------------------
//  create panel commands table
//-----------------------------------------------------------------------------
        const panel_com_table     = document.getElementById('panel_commands');

        panel_com_table.innerHTML = `
        <tbody>
          <tr>
            <td> <div class="mtableheader" colspan=2> Panel commands </div> </td> 
            <td colspan=4>
            <div class="tab">
            </div>
            </td>
          </tr>
          <tr>
            <td colspan=2>
              <div class="dropup">
                <input type=button class="dropbtn" value='read'>
                <div class="dropup-content">
                  <div onClick='dtc_load_parameters_control_roc_read()'> Load Parameters </div>
                  <div onClick='dtc_command("dtc_control_roc_read")'   > Run             </div>
                </div>
              </div>
              <div class="dropup">
                <input type=button class="dropbtn" value='digi_rw'>
                <div class="dropup-content">
                  <div onClick='dtc_load_parameters_control_roc_digi_rw()'> Load Parameters </div>
                  <div onClick='dtc_command("dtc_control_roc_digi_rw")'   > Run             </div>
                </div>
              </div>
              <div class="dropup">
                <input type=button class="dropbtn" value='pulser_on'>
                <div class="dropup-content">
                  <div onClick='dtc_load_parameters_control_roc_pulser_on()'> Load Parameters </div>
                  <div onClick='dtc_command("dtc_control_roc_pulser_on")'   > Run             </div>
                </div>
              </div>
              <div class="dropup">
                <input type=button class="dropbtn" value='pulser_off'>
                <div class="dropup-content">
                  <div onClick='dtc_load_parameters_control_roc_pulser_off()'> Load Parameters </div>
                  <div onClick='dtc_command("dtc_control_roc_pulser_off")'   > Run             </div>
                </div>
              </div>
              <div class="dropup">
                <input type=button class="dropbtn" value='rates'>
                <div class="dropup-content">
                  <div onClick='dtc_load_parameters_control_roc_rates()'> Load Parameters </div>
                  <div onClick='dtc_command("dtc_control_roc_rates")'   > Run             </div>
                </div>
              </div>
              <div class="dropup">
                <input type=button class="dropbtn" value='read_ddr'>
                <div class="dropup-content">
                  <div onClick='dtc_load_parameters_control_roc_read_ddr()'> Load Parameters </div>
                  <div onClick='dtc_command("dtc_control_roc_read_ddr")'   > Run             </div>
                </div>
              </div>
              <div class="dropup">
                <input type=button class="dropbtn" value='set_thresholds'>
                <div class="dropup-content">
                  <div onClick='dtc_load_parameters_control_roc_set_thresholds()'> Load Parameters </div>
                  <div onClick='dtc_command("dtc_control_roc_set_thresholds")'   > Run             </div>
                </div>
              </div>
              <div class="dropup">
                <input type=button class="dropbtn" value='load_thresholds'>
                <div class="dropup-content">
                  <div onClick='dtc_load_parameters_control_roc_load_thresholds()'> Load Parameters </div>
                  <div onClick='dtc_command("dtc_control_roc_load_thresholds")'   > Run             </div>
                </div>
              </div>
            </td>
            </td>
          </tr>

<!--  --------------------------------------------  -->
        <tr>
          <td>
            <input type=button value='load parameters'    onClick='trk_panel_load_parameters(g_station,g_plane,g_panel)'>
            <input type=button value='cycle LV'           onClick='trk_command_set_odb("cycle_lv")'>
            <input type=button value='measure thresholds' onClick='trk_command_set_odb("trk_measure_thresholds")'>
            <input type=button value='print status'       onClick='trk_command_set_odb("trk_panel_print_status")'>
          </td>
        </tr>
<!--  --------------------------------------------  -->
        <tr>
          <td colspan>
          </td>
        </tr>
        <!---------------------------------------------- this row is temporarily commented out
        <tr>
          <td colspan=4>
            <div class="dropup">
            </div>
          </td>
        </tr>
          --------------------------------------------  -->
        </tbody>
        `;      
//-----------------------------------------------------------------------------
//  end
//-----------------------------------------------------------------------------
      }
      
      document.addEventListener("DOMContentLoaded", createTable);
      // choose_roc_id('DOMContentLoaded','roc0')
      </script>
  </head>
  <!--
      it seems to be convenient to have the large scale topology defined in HTML
      and use javascript to fill internal details
    -->
  <body class="mcss" onload="mhttpd_init('trk_control');show_facilities(); msg_load();">
    <div id="mheader"></div>
    <div id="msidenav"></div>
    <div id="mmain">
    
      <!-- ---------------- are they needed? and the output field ----------------  -->
      
      <div class="row">
        <h2 id="table-title">Panel </h2>
        
        <div class="column"> <!-- gets pushed to the left -->
          
          <table class="mtable" id="station_commands">  <!-- Table content is generated dynamically -->
          </table>
          
          <table class="mtable" id="panel_commands">  <!-- Table content is generated dynamically -->
          </table>
          
          <table class="mtable" id="cmd_params">    <!-- Table content is generated dynamically -->
          </table>
          
        </div>
        
        <!--    ------------------------- this is the output window  -->
        <table style="width: 52%;">
          <tr>
            <td id="navigationFacilitiesButtons"></td>
          </tr>
        </table>
        
        <table class="mtable" id="messageTable" style="width: 52%;">
          <tr>
            <td class="select">
              <label for="nameFilter">Filter: </label>

              <input type="text" id="nameFilter" placeholder="Program Name" title="Please enter a program name">
              
              <select id="typeFilter" title="Please select a message type">
                <option value="">- all -</option>
                <option>INFO</option>
                <option>ERROR</option>
                <option>USER</option>
                <option>LOG</option>
                <option>TALK</option>
              </select>
              
              <input type="text" id="timeFilter" placeholder="Time (hh:mm:ss)" title="Please select a time to search">
              <input type="text" id="textFilter" placeholder="Search Text" title="Please enter some search text">

              <select id="timeRangeFilter" title="We will search the file from the current time into the past">
                <option>24 h</option>
                <option>48 h</option>
                <option>72 h</option>
                <option>7 d</option>
                <option>30 d</option>
              </select>
              <button class="mbutton" id="filterBtn">Filter</button>
              
              <select id="recentsDropdown">
                <option value="">Select a recent filter</option>
              </select>

            </td>
          </tr>

          <tr>
            <td class="select">
              <div class="mmessagebox mfont" id="messageFrame"><h1 class="mtableheader"> Messages</h1></div>
            </td>
          </tr>
          
        </table>
        
        <div id="loadingOverlay"
             style="  display: none;
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    <!--
                    height: 100%;
                    -->
                    height: 600px;
                    background-color: rgba(128, 128, 128, 0.8);
                    color: white;
                    font-size: 24px;
                    align-items: center;
                    justify-content: center;
                  z-index: 1000;">
          Searching messages... Mouse Click to stop.
        </div>
      
      </div>

      
      <div id="dlgError" class="dlgFrame">
        <div class="dlgTitlebar">Error message</div>
        <div class="dlgPanel">
          <div id="dlgErrorText">Dialog Contents</div>
          <br />
          <button class="dlgButton" onClick="dlgHide('dlgError')">Close</button>
        </div>
      </div>

      <script src="messages.js"></script>

    </div>
  </body>
</html>

<!--
    emacs
    Local Variables:
    tab-width: 8
    c-basic-offset: 2
    js-indent-level: 0
    indent-tabs-mode: nil
    End:
  -->
