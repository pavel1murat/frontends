COMMENT "8 calibratioin runs with the external pulser"
comment "automated" 
ODBGET "/Mu2e/ActiveRunConfiguration/UseRunInfoDB" , use_rundb

RUNDESCRIPTION "pulse injection run"
PARAM runs, "aaaaa", 8

ODBSET "/Mu2e/ActiveRunConfiguration/Tracker/Command/pulser_on/pulser_delay", 1000
ODBSET "/Mu2e/ActiveRunConfiguration/Tracker/Command/pulser_on/duty_cycle"  ,   10
ODBSET "/Mu2e/ActiveRunConfiguration/Tracker/Command/pulser_on/print_level" ,    0

first_channel_mask = 1

LOOP i, $runs
   
   ODBSET "/Mu2e/ActiveRunConfiguration/Tracker/Command/pulser_on/first_channel_mask",  $first_channel_mask
   
   odbset            "/Mu2e/ActiveRunConfiguration/Tracker/Command/Name"    , "PulserOn", 0
   odbset            "/Mu2e/ActiveRunConfiguration/Tracker/Command/FInished", 0 , 0
   odbset            "/Mu2e/ActiveRunConfiguration/Tracker/Command/Run"     , 1 , 1
   wait   ODBValue , "/Mu2e/ActiveRunConfiguration/Tracker/Command/Finished", > , 0
   odbset            "/Mu2e/ActiveRunConfiguration/Tracker/Command/Run"     , 0 , 0


   comment "configuration finished, proceed with the data taking"
   
   IF ($use_rundb != 0)
      script get_next_run_number.py
   ENDIF

  msg "beginning of the start transition: $i"
  TRANSITION START
  msg "end  of the start transition : $i"
  comment "now take data for 10 seconds"
  WAIT Seconds, 10
  msg "beginning of the STOP transition $i"
  TRANSITION STOP
  msg "end of the stop transition $i"
  wait seconds, 10
  first_channel_mask = $first_channel_mask*2
ENDLOOP